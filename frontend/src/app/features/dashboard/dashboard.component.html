<div class="dashboard-container">
  <div class="dashboard-header">
    <h1>Dashboard</h1>
    <button mat-raised-button color="primary" (click)="refresh()">
      <mat-icon>refresh</mat-icon>
      Refresh
    </button>
  </div>

  <div *ngIf="loading" class="loading-container">
    <mat-spinner></mat-spinner>
  </div>

  <div *ngIf="!loading" class="dashboard-content">
    <!-- Admin Stats -->
    <div *ngIf="isAdmin" class="stats-grid">
      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-icon" style="background-color: #3f51b5;">
            <mat-icon>people</mat-icon>
          </div>
          <div class="stat-info">
            <h3>{{ stats.totalUsers || 0 }}</h3>
            <p>Total Users</p>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-icon" style="background-color: #4caf50;">
            <mat-icon>person_check</mat-icon>
          </div>
          <div class="stat-info">
            <h3>{{ stats.activeUsers || 0 }}</h3>
            <p>Active Users</p>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-icon" style="background-color: #ff9800;">
            <mat-icon>chat_bubble</mat-icon>
          </div>
          <div class="stat-info">
            <h3>{{ stats.totalRooms || 0 }}</h3>
            <p>Chat Rooms</p>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-icon" style="background-color: #f44336;">
            <mat-icon>message</mat-icon>
          </div>
          <div class="stat-info">
            <h3>{{ stats.totalMessages || 0 }}</h3>
            <p>Total Messages</p>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- User Stats -->
    <div *ngIf="!isAdmin" class="stats-grid">
      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-icon" style="background-color: #3f51b5;">
            <mat-icon>chat</mat-icon>
          </div>
          <div class="stat-info">
            <h3>{{ stats.myRooms || 0 }}</h3>
            <p>My Chat Rooms</p>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-icon" style="background-color: #4caf50;">
            <mat-icon>send</mat-icon>
          </div>
          <div class="stat-info">
            <h3>{{ stats.myMessages || 0 }}</h3>
            <p>Messages Sent</p>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Recent Activity -->
    <div class="activity-section">
      <mat-card>
        <mat-card-header>
          <mat-card-title>Recent Activity</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div *ngIf="isAdmin && stats.recentUsers && stats.recentUsers.length > 0">
            <h3>Recent Users</h3>
            <mat-list>
              <mat-list-item *ngFor="let user of stats.recentUsers">
                <mat-icon matListItemIcon>person</mat-icon>
                <div matListItemTitle>{{ user.firstName }} {{ user.lastName }}</div>
                <div matListItemLine>{{ user.email }}</div>
                <div matListItemMeta>
                  <small>{{ user.createdAt | date:'short' }}</small>
                </div>
              </mat-list-item>
            </mat-list>
          </div>

          <div *ngIf="!isAdmin && stats.recentMessages && stats.recentMessages.length > 0">
            <h3>Recent Messages</h3>
            <mat-list>
              <mat-list-item *ngFor="let message of stats.recentMessages">
                <mat-icon matListItemIcon>message</mat-icon>
                <div matListItemTitle>{{ message.roomId?.name || 'Private Chat' }}</div>
                <div matListItemLine>{{ message.content | slice:0:50 }}...</div>
                <div matListItemMeta>
                  <small>{{ message.createdAt | date:'short' }}</small>
                </div>
              </mat-list-item>
            </mat-list>
          </div>

          <div *ngIf="(!stats.recentUsers || stats.recentUsers.length === 0) && (!stats.recentMessages || stats.recentMessages.length === 0)">
            <p class="no-activity">No recent activity</p>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
      <mat-card>
        <mat-card-header>
          <mat-card-title>Quick Actions</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="action-buttons">
            <button mat-raised-button color="primary" routerLink="/chat">
              <mat-icon>chat</mat-icon>
              Go to Chat
            </button>
            <button mat-raised-button color="accent" routerLink="/admin" *ngIf="isAdmin">
              <mat-icon>admin_panel_settings</mat-icon>
              Manage Users
            </button>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  </div>
</div>
